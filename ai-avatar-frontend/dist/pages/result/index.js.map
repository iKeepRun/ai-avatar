{"version":3,"file":"pages/result/index.js","mappings":";;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC7IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://ai-avatar-frontend/./src/pages/result/index.tsx?2280","webpack://ai-avatar-frontend/._src_pages_result_index.tsx"],"sourcesContent":["import _regeneratorRuntime from \"D:/_code/ai-avatar/ai-avatar-mini-program/ai-avatar-frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"D:/_code/ai-avatar/ai-avatar-mini-program/ai-avatar-frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _slicedToArray from \"D:/_code/ai-avatar/ai-avatar-mini-program/ai-avatar-frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport { useState, useEffect } from 'react';\nimport { View, Image } from '@tarojs/components';\nimport Taro, { useRouter } from '@tarojs/taro';\nimport { observer } from 'mobx-react';\nimport { useStore } from '@/stores';\nimport { avatarApi } from '@/services/api';\nimport './index.scss';\nimport { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from \"react/jsx-runtime\";\nvar ResultPage = function ResultPage() {\n  var router = useRouter();\n  var _useStore = useStore(),\n    avatarStore = _useStore.avatarStore;\n  var _useState = useState(true),\n    _useState2 = _slicedToArray(_useState, 2),\n    loading = _useState2[0],\n    setLoading = _useState2[1];\n  var _useState3 = useState(''),\n    _useState4 = _slicedToArray(_useState3, 2),\n    result = _useState4[0],\n    setResult = _useState4[1];\n  useEffect(function () {\n    _checkResult();\n  }, []);\n  var _checkResult = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n      var res;\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            _context.next = 3;\n            return avatarApi.getResult(avatarStore.taskId);\n          case 3:\n            res = _context.sent;\n            if (res.data.status === 'completed' && res.data.resultUrl) {\n              setResult(res.data.resultUrl);\n              setLoading(false);\n            } else if (res.data.status === 'failed') {\n              Taro.showToast({\n                title: '生成失败',\n                icon: 'none'\n              });\n              setTimeout(function () {\n                Taro.navigateBack();\n              }, 1500);\n            } else {\n              setTimeout(_checkResult, 1000);\n            }\n            _context.next = 10;\n            break;\n          case 7:\n            _context.prev = 7;\n            _context.t0 = _context[\"catch\"](0);\n            Taro.showToast({\n              title: '获取结果失败',\n              icon: 'none'\n            });\n          case 10:\n          case \"end\":\n            return _context.stop();\n        }\n      }, _callee, null, [[0, 7]]);\n    }));\n    return function checkResult() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n  var handleSave = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n      return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n        while (1) switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.prev = 0;\n            _context2.next = 3;\n            return Taro.saveImageToPhotosAlbum({\n              filePath: result\n            });\n          case 3:\n            Taro.showToast({\n              title: '保存成功',\n              icon: 'success'\n            });\n            _context2.next = 9;\n            break;\n          case 6:\n            _context2.prev = 6;\n            _context2.t0 = _context2[\"catch\"](0);\n            Taro.showToast({\n              title: '保存失败',\n              icon: 'none'\n            });\n          case 9:\n          case \"end\":\n            return _context2.stop();\n        }\n      }, _callee2, null, [[0, 6]]);\n    }));\n    return function handleSave() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n  var handleShare = function handleShare() {\n    Taro.showShareMenu({\n      withShareTicket: true\n    });\n  };\n  return /*#__PURE__*/_jsx(View, {\n    className: \"result\",\n    children: loading ? /*#__PURE__*/_jsxs(View, {\n      className: \"loading\",\n      children: [/*#__PURE__*/_jsx(View, {\n        className: \"loading-icon\"\n      }), /*#__PURE__*/_jsx(View, {\n        className: \"loading-text\",\n        children: \"\\u751F\\u6210\\u4E2D...\"\n      })]\n    }) : /*#__PURE__*/_jsxs(_Fragment, {\n      children: [/*#__PURE__*/_jsx(View, {\n        className: \"result-image\",\n        children: /*#__PURE__*/_jsx(Image, {\n          src: result,\n          mode: \"aspectFit\"\n        })\n      }), /*#__PURE__*/_jsxs(View, {\n        className: \"action-bar\",\n        children: [/*#__PURE__*/_jsx(View, {\n          className: \"action-btn save-btn\",\n          onClick: handleSave,\n          children: \"\\u4FDD\\u5B58\\u5230\\u76F8\\u518C\"\n        }), /*#__PURE__*/_jsx(View, {\n          className: \"action-btn share-btn\",\n          onClick: handleShare,\n          children: \"\\u5206\\u4EAB\"\n        })]\n      })]\n    })\n  });\n};\nexport default observer(ResultPage);","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"!!../../../node_modules/@tarojs/taro-loader/lib/entry-cache.js?name=pages/result/index!./index.tsx\"\nvar config = {};\n\n\nvar inst = Page(createPageConfig(component, 'pages/result/index', {root:{cn:[]}}, config || {}))\n\n\nexport default component\n"],"names":[],"sourceRoot":""}