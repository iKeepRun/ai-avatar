{"version":3,"file":"pages/result/index.js","mappings":";;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACxKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://ai-avatar-frontend/./src/pages/result/index.tsx?2280","webpack://ai-avatar-frontend/._src_pages_result_index.tsx"],"sourcesContent":["import _regeneratorRuntime from \"D:/_code/ai-avatar/ai-avatar-frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"D:/_code/ai-avatar/ai-avatar-frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _slicedToArray from \"D:/_code/ai-avatar/ai-avatar-frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport { useState, useEffect } from 'react';\nimport { View, Image } from '@tarojs/components';\nimport Taro from '@tarojs/taro';\nimport { observer } from 'mobx-react';\nimport { avatarApi } from '@/services/api';\nimport './index.scss';\nimport { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from \"react/jsx-runtime\";\nexport default observer(function ResultPage() {\n  var _useState = useState(''),\n    _useState2 = _slicedToArray(_useState, 2),\n    resultImage = _useState2[0],\n    setResultImage = _useState2[1];\n  var _useState3 = useState(true),\n    _useState4 = _slicedToArray(_useState3, 2),\n    loading = _useState4[0],\n    setLoading = _useState4[1];\n  var _useState5 = useState(''),\n    _useState6 = _slicedToArray(_useState5, 2),\n    error = _useState6[0],\n    setError = _useState6[1];\n  useEffect(function () {\n    var _Taro$getCurrentInsta;\n    var taskId = (_Taro$getCurrentInsta = Taro.getCurrentInstance().router) === null || _Taro$getCurrentInsta === void 0 ? void 0 : _Taro$getCurrentInsta.params.taskId;\n    if (taskId) {\n      pollTaskStatus(taskId);\n    }\n  }, []);\n  var pollTaskStatus = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(taskId) {\n      var completed, result;\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) switch (_context.prev = _context.next) {\n          case 0:\n            completed = false;\n          case 1:\n            if (completed) {\n              _context.next = 29;\n              break;\n            }\n            _context.prev = 2;\n            _context.next = 5;\n            return avatarApi.getTaskResult(taskId);\n          case 5:\n            result = _context.sent;\n            if (!(result.data.status === 1)) {\n              _context.next = 12;\n              break;\n            }\n            completed = true;\n            setResultImage(result.data.resultImageUrl);\n            setLoading(false);\n            _context.next = 20;\n            break;\n          case 12:\n            if (!(result.data.status === 2)) {\n              _context.next = 18;\n              break;\n            }\n            completed = true;\n            setError(result.data.errorMessage);\n            setLoading(false);\n            _context.next = 20;\n            break;\n          case 18:\n            _context.next = 20;\n            return new Promise(function (resolve) {\n              return setTimeout(resolve, 2000);\n            });\n          case 20:\n            _context.next = 27;\n            break;\n          case 22:\n            _context.prev = 22;\n            _context.t0 = _context[\"catch\"](2);\n            completed = true;\n            setError('查询任务状态失败');\n            setLoading(false);\n          case 27:\n            _context.next = 1;\n            break;\n          case 29:\n          case \"end\":\n            return _context.stop();\n        }\n      }, _callee, null, [[2, 22]]);\n    }));\n    return function pollTaskStatus(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n  var handleSave = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n      return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n        while (1) switch (_context2.prev = _context2.next) {\n          case 0:\n            if (!resultImage) {\n              _context2.next = 10;\n              break;\n            }\n            _context2.prev = 1;\n            _context2.next = 4;\n            return Taro.saveImageToPhotosAlbum({\n              filePath: resultImage\n            });\n          case 4:\n            Taro.showToast({\n              title: '保存成功',\n              icon: 'success'\n            });\n            _context2.next = 10;\n            break;\n          case 7:\n            _context2.prev = 7;\n            _context2.t0 = _context2[\"catch\"](1);\n            Taro.showToast({\n              title: '保存失败',\n              icon: 'none'\n            });\n          case 10:\n          case \"end\":\n            return _context2.stop();\n        }\n      }, _callee2, null, [[1, 7]]);\n    }));\n    return function handleSave() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n  var handleShare = function handleShare() {\n    Taro.showShareMenu({\n      withShareTicket: true\n    });\n  };\n  return /*#__PURE__*/_jsx(View, {\n    className: \"result\",\n    children: loading ? /*#__PURE__*/_jsxs(View, {\n      className: \"loading\",\n      children: [/*#__PURE__*/_jsx(View, {\n        className: \"loading-icon\",\n        children: \"xxxxx\"\n      }), /*#__PURE__*/_jsx(View, {\n        className: \"loading-text\",\n        children: \"\\u751F\\u6210\\u4E2D...\"\n      })]\n    }) : /*#__PURE__*/_jsxs(_Fragment, {\n      children: [/*#__PURE__*/_jsx(View, {\n        className: \"result-image\",\n        children: /*#__PURE__*/_jsx(Image, {\n          src: resultImage,\n          mode: \"aspectFit\"\n        })\n      }), /*#__PURE__*/_jsxs(View, {\n        className: \"action-bar\",\n        children: [/*#__PURE__*/_jsx(View, {\n          className: \"action-btn save-btn\",\n          onClick: handleSave,\n          children: \"\\u4FDD\\u5B58\\u5230\\u76F8\\u518C\"\n        }), /*#__PURE__*/_jsx(View, {\n          className: \"action-btn share-btn\",\n          onClick: handleShare,\n          children: \"\\u5206\\u4EAB\"\n        })]\n      })]\n    })\n  });\n});","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"!!../../../node_modules/@tarojs/taro-loader/lib/entry-cache.js?name=pages/result/index!./index.tsx\"\nvar config = {};\n\n\nvar inst = Page(createPageConfig(component, 'pages/result/index', {root:{cn:[]}}, config || {}))\n\n\nexport default component\n"],"names":[],"sourceRoot":""}